import os
import subprocess

sources = Glob('source/*.d')

testEnvironment = Environment(
    tools=['dub', 'ldc', 'link'],
    DFLAGS=['-unittest'],
    DC='/home/users/russel/BuildArea/LDC/bin/ldc2',
)
unit_threaded = testEnvironment.AddDubLibrary('unit-threaded', '0.7.49')
ut_main = testEnvironment.UnitThreadedMakeMain('ut_main.d', sources)

factorial_test = testEnvironment.ProgramAllAtOnce('factorial_test', sources + ut_main)
SideEffect('factorial_test.o', factorial_test)

Default(Command('test', factorial_test, './$SOURCE'))

Clean('.', ut_main)
