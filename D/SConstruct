import os
import subprocess

environment = Environment(
    tools=['dub', 'ldc', 'link'],
)
environment.AddDubLibrary('unit-threaded', '0.7.28')
environment.UnitThreadedMakeMain('ut_main.d')

factorial_test = environment.Command(
    'factorial_test',
    ['factorial.d', 'ut_main.d'],
    '$DC $_DINCFLAGS $_DVERFLAGS $_DDEBUGFLAGS $_DFLAGS -unittest -of$TARGET $DLINKFLAGS $__DRPATH $SOURCES $_DLIBDIRFLAGS $_DLIBFLAGS',
)
SideEffect('factorial_test.o', factorial_test)

Default(Command('test', factorial_test, './$SOURCE'))

Clean('.', 'ut_main.d')
